<html>

<head></head>

<body>
    <button onclick="wave.play()">Play</button>
    <button onclick="ripple()">Ripple</button>
    <div id="chart-container" style="width: 100%; height: 100%;"></div>
    <!-- <script src="../dist/circular-audio-wave.min.js"></script> -->

    <!-- remove these later -->
    <script src="../lib/echarts_3.8.5.js"></script>
    <script src="../src/js/circular-audio-wave.js"></script>



    <script>

        
        //let wave = new CircularAudioWave(document.getElementById('chart-container'), {loop: true});
        let wave = new CircularAudioWave(document.getElementById('chart-container'));
        wave.loadAudio('audio/audio1.mp3');

        let lastMaxR = 0;
        function drawSpectrum(array) {
            // for ( var i = 0; i < (array.length); i++ ){
            //     var value = array[i];
            //     ctx.fillRect(i*5,325-value,3,325);
            // }
            //console.log(array);
            if (playing) {
                let waveData = generateWaveData(array);
                option.series[0].data = waveData.data;
                //console.log(waveData.maxR);
                if (waveData.maxR > lastMaxR) {
                    lastMaxR = waveData.maxR;
                }
                else {
                    lastMaxR -= 4;
                }

                option.series[2].data = Array.apply(null, { length: 361 }).map(Function.call, function (i) {
                    return [lastMaxR, i];
                });
                chart.setOption(option);
            }



        };

        let rippleLevel = 0;
        function ripple() {
            let rippleData = Array.apply(null, { length: 361 }).map(Function.call, function (i) {
                let r;
                switch (rippleLevel) {
                    case 0:
                        r = 100;
                        break;
                    case 1:
                        r = 120;
                        break;
                    case 2:
                        r = 140;
                        break;
                    case 3:
                        r = 160;
                        break;
                }
                return [r, i];
            });
            rippleLevel++;
            if (rippleLevel === 4) {
                rippleLevel = 0;
                option.series[1].data = [];
            }
            //rippleData = rippleData.slice(1, rippleData.length);
            // if (option.series[1].data.length) {
            //     option.series[1].data[option.series[1].data.length - 1] = null;
            // }
            option.series[1].data = option.series[1].data.concat(rippleData);

            chart.setOption(option);
        }


        const generateWaveData = (data) => {
            let waveData = [];
            let maxR = 0;
            for (let i = 0; i <= 360; i++) {
                // max: 160, min: 60
                // (((OldValue - OldMin) * (NewMax - NewMin)) / (OldMax - OldMin)) + NewMin
                let freq = data[i];
                var r = (((freq - 0) * (maxChartValue - minChartValue)) / (255 - 0)) + minChartValue;
                if (r > maxR) {
                    maxR = r;
                }
                waveData.push([r, i]);
            }
            waveData.push([waveData[0][0], 360]);
            return { maxR: maxR, data: waveData };
        };


    </script>
</body>

</html>